---
layout:     post
title:      kafka设计——官方文档翻译
date:       2017-12-01
author:     hsd
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 数据挖掘
    - 机器学习
---
>..未完待续
# 4.设计
## 4.1 动机
我们设计kafka使其成为一个能够处理大公司产生的所有实时数据的统一平台，为了做到这点我们不得不考虑相当广泛的使用场景
它需要有高吞吐量来支撑大量的事件流比如实时日志聚合
它得优雅地处理大量的数据backlog（日志？）来支撑周期性地离线系统数据导入
同时意味着系统不得不有低延迟消息交付，来应对更加传统的消息使用场景
We wanted to support partitioned, distributed, real-time processing of these feeds to create new, derived feeds. This motivated our partitioning and consumer model.（中间那个feed不是特别理解）
最后在流被送入其他数据系统时，我们知道系统不得不在机器宕机的情况下保证容错
支持这些使用场景将我们指引到一种设计，即有一堆唯一的元素（unique elements)，相比传统消息系统而言更像是数据库日志。我们会在接下来的部分概述下设计中的一些元素
## 4.2 持久化
### 不要害怕文件系统
Kafka严重地依赖文件系统来存储和缓存消息，人们通常认为硬盘是缓慢的，这使得人们怀疑一个持久化的结构是否能提供一个有竞争力的性能。实际上磁盘比人们想象中要更慢、更快，取决于他们怎么使用，同时一个经过恰当设计的磁盘结构通常能和网络一样快
关于磁盘性能很重要的一个事实就是硬盘的吞吐量。结果就是，顺序写一个7200rpm SATA RAID-5 array的JBOD大概是600MB/sec但是随机写只有大约100k/sec，差了超过6000倍...这些顺序读写是所有使用模式中最可预见的，同时被操作系统大量优化过。一个现代的操作系统提供预读和延迟写(write-behind)技术，即读取多个大块数据，将小的逻辑写合并到大的物理写。关于这个话题更深入的讨论可以在[ACM Queue article](http://queue.acm.org/detail.cfm?id=1563874)中找到，他们实际发现[顺序磁盘访问在某些情况下比随机内存访问要快!](http://deliveryimages.acm.org/10.1145/1570000/1563874/jacobs3.jpg)
